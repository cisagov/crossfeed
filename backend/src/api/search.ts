import {
    IsInt,
    IsPositive,
    IsString,
    IsIn,
    ValidateNested,
    isUUID,
    IsOptional,
    IsObject,
    IsUUID
  } from 'class-validator';
  import { Type } from 'class-transformer';
  import { Domain, connectToDatabase } from '../models';
  import { validateBody, wrapHandler, NotFound } from './helpers';
  import { SelectQueryBuilder, In } from 'typeorm';
  import { isGlobalViewAdmin, getOrgMemberships } from './auth';
  import ESClient from '../tasks/es-client';
  
  
export const search = wrapHandler(async (event) => {
    if (!isGlobalViewAdmin(event) && getOrgMemberships(event).length === 0) {
        return {
        statusCode: 200,
        body: JSON.stringify({
            result: [],
            count: 0
        })
        };
    }
    await connectToDatabase();
    // const search = await validateBody(DomainSearch, event.body);

    const client = new ESClient();
    const searchResults = await client.searchDomains();

    console.error(searchResults.body);

    return {
        statusCode: 200,
        body: JSON.stringify(searchResults.body)
    }

    return {
        statusCode: 200,
        // body: JSON.stringify({
        //     searchResults,
        // })
        body: JSON.stringify({"took":10,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":38,"relation":"eq"},"max_score":0.6740048,"hits":[{"_index":"national-parks","_type":"_doc","_id":"OG18l2oBD5fKNxKi45d9","_score":0.6740048,"_source":{"description":"This park contains Guadalupe Peak, the highest point in Texas, as well as the scenic McKittrick Canyon filled with bigtooth maples, a corner of the arid Chihuahuan Desert, and a fossilized coral reef from the Permian era.","id":"park_guadalupe-mountains","title":"Guadalupe Mountains","nps_link":"https://www.nps.gov/gumo/index.htm"},"highlight":{"description":["This park contains Guadalupe Peak, the highest point in Texas, as well as the scenic McKittrick Canyon filled with bigtooth maples, <em>a</em> corner of the arid Chihuahuan Desert, and <em>a</em> fossilized coral reef from"]}},{"_index":"national-parks","_type":"_doc","_id":"OW18l2oBD5fKNxKi45d-","_score":0.6418546,"_source":{"description":"The Haleakala volcano on Maui features a very large crater with numerous cinder cones, Hosmer's Grove of alien trees, the Kipahulu section's scenic pools of freshwater fish, and the native Hawaiian goose. It is home to the greatest number of endangered species within a U.S. National Park.","id":"park_haleakala","title":"Haleakala","nps_link":"https://www.nps.gov/hale/index.htm"},"highlight":{"description":["It is home to the greatest number of endangered species within <em>a</em> U.S. National Park."]}},{"_index":"national-parks","_type":"_doc","_id":"Vm18l2oBD5fKNxKi45d-","_score":0.6380335,"_source":{"description":"Yosemite features sheer granite cliffs, exceptionally tall waterfalls, and old-growth forests at a unique intersection of geology and hydrology. Half Dome and El Capitan rise from the park's centerpiece, the glacier-carved Yosemite Valley, and from its vertical walls drop Yosemite Falls, one of North America's tallest waterfalls at 2,425 feet (739 m) high. Three giant sequoia groves, along with a pristine wilderness in the heart of the Sierra Nevada, are home to a wide variety of rare plant and animal species.","id":"park_yosemite","title":"Yosemite","nps_link":"https://www.nps.gov/yose/index.htm"},"highlight":{"description":["Three giant sequoia groves, along with <em>a</em> pristine wilderness in the heart of the Sierra Nevada, are home to <em>a</em> wide variety of rare plant and animal species."]}},{"_index":"national-parks","_type":"_doc","_id":"Um18l2oBD5fKNxKi45d-","_score":0.62207246,"_source":{"description":"This park protecting four lakes near the Canada–US border is a site for canoeing, kayaking, and fishing. The park also preserves a history populated by Ojibwe Native Americans, French fur traders called voyageurs, and gold miners. Formed by glaciers, the region features tall bluffs, rock gardens, islands, bays, and several historic buildings.","id":"park_voyageurs","title":"Voyageurs","nps_link":"https://www.nps.gov/voya/index.htm"},"highlight":{"description":["This park protecting four lakes near the Canada–US border is <em>a</em> site for canoeing, kayaking, and fishing."]}},{"_index":"national-parks","_type":"_doc","_id":"Sm18l2oBD5fKNxKi45d-","_score":0.6205957,"_source":{"description":"Named for the eroded leftovers of a portion of an extinct volcano, the park's massive black and gold monoliths of andesite and rhyolite are a popular destination for rock climbers. Hikers have access to trails crossing the Coast Range wilderness. The park is home to the endangered California condor (Gymnogyps californianus) and one of the few locations in the world where these extremely rare birds can be seen in the wild. Pinnacles also supports a dense population of prairie falcons, and more than 13 species of bat which populate its talus caves.","id":"park_pinnacles","title":"Pinnacles","nps_link":"https://www.nps.gov/pinn/index.htm"},"highlight":{"description":["Named for the eroded leftovers of <em>a</em> portion of an extinct volcano, the park's massive black and gold monoliths of andesite and rhyolite are <em>a</em> popular destination for rock climbers."]}},{"_index":"national-parks","_type":"_doc","_id":"Tm18l2oBD5fKNxKi45d-","_score":0.6157467,"_source":{"description":"This park protects the Giant Forest, which boasts some of the world's largest trees, the General Sherman being the largest measured tree in the park. Other features include over 240 caves, a long segment of the Sierra Nevada including the tallest mountain in the contiguous United States, and Moro Rock, a large granite dome.","id":"park_sequoia","title":"Sequoia","nps_link":"https://www.nps.gov/seki/index.htm"},"highlight":{"description":["Other features include over 240 caves, <em>a</em> long segment of the Sierra Nevada including the tallest mountain in the contiguous United States, and Moro Rock, <em>a</em> large granite dome."]}},{"_index":"national-parks","_type":"_doc","_id":"I218l2oBD5fKNxKi45d9","_score":0.5975184,"_source":{"description":"The park protects a quarter of the Gunnison River, which slices sheer canyon walls from dark Precambrian-era rock. The canyon features some of the steepest cliffs and oldest rock in North America, and is a popular site for river rafting and rock climbing. The deep, narrow canyon is composed of gneiss and schist which appears black when in shadow.","id":"park_black-canyon-of-the-gunnison","title":"Black Canyon of the Gunnison","nps_link":"https://www.nps.gov/blca/index.htm"},"highlight":{"description":["The park protects <em>a</em> quarter of the Gunnison River, which slices sheer canyon walls from dark Precambrian-era rock."]}},{"_index":"national-parks","_type":"_doc","_id":"IW18l2oBD5fKNxKi45d9","_score":0.58595407,"_source":{"description":"Named for the prominent bend in the Rio Grande along the U.S.–Mexico border, this park encompasses a large and remote part of the Chihuahuan Desert. Its main attraction is backcountry recreation in the arid Chisos Mountains and in canyons along the river. A wide variety of Cretaceous and Tertiary fossils as well as cultural artifacts of Native Americans also exist within its borders.","id":"park_big-bend","title":"Big Bend","nps_link":"https://www.nps.gov/bibe/index.htm"},"highlight":{"description":["<em>A</em> wide variety of Cretaceous and Tertiary fossils as well as cultural artifacts of Native Americans also exist within its borders."]}},{"_index":"national-parks","_type":"_doc","_id":"QW18l2oBD5fKNxKi45d-","_score":0.56411844,"_source":{"description":"Kobuk Valley protects 61 miles (98 km) of the Kobuk River and three regions of sand dunes. Created by glaciers, the Great Kobuk, Little Kobuk, and Hunt River Sand Dunes can reach 100 feet (30 m) high and 100 °F (38 °C), and they are the largest dunes in the Arctic. Twice a year, half a million caribou migrate through the dunes and across river bluffs that expose well-preserved ice age fossils.","id":"park_kobuk-valley","title":"Kobuk Valley","nps_link":"https://www.nps.gov/kova/index.htm"},"highlight":{"description":["Twice <em>a</em> year, half <em>a</em> million caribou migrate through the dunes and across river bluffs that expose well-preserved ice age fossils."]}},{"_index":"national-parks","_type":"_doc","_id":"JG18l2oBD5fKNxKi45d9","_score":0.53282064,"_source":{"description":"Bryce Canyon is a geological amphitheater on the Paunsaugunt Plateau with hundreds of tall, multicolored sandstone hoodoos formed by erosion. The region was originally settled by Native Americans and later by Mormon pioneers.","id":"park_bryce-canyon","title":"Bryce Canyon","nps_link":"https://www.nps.gov/brca/index.htm"},"highlight":{"description":["Bryce Canyon is <em>a</em> geological amphitheater on the Paunsaugunt Plateau with hundreds of tall, multicolored sandstone hoodoos formed by erosion."]}},{"_index":"national-parks","_type":"_doc","_id":"Jm18l2oBD5fKNxKi45d9","_score":0.53282064,"_source":{"description":"The park's Waterpocket Fold is a 100-mile (160 km) monocline that exhibits the earth's diverse geologic layers. Other natural features include monoliths, cliffs, and sandstone domes shaped like the United States Capitol.","id":"park_capitol-reef","title":"Capitol Reef","nps_link":"https://www.nps.gov/care/index.htm"},"highlight":{"description":["The park's Waterpocket Fold is <em>a</em> 100-mile (160 km) monocline that exhibits the earth's diverse geologic layers."]}},{"_index":"national-parks","_type":"_doc","_id":"Qm18l2oBD5fKNxKi45d-","_score":0.52817297,"_source":{"description":"The region around Lake Clark features four active volcanoes, including Mount Redoubt, as well as an abundance of rivers, glaciers, and waterfalls. Temperate rainforests, a tundra plateau, and three mountain ranges complete the landscape.","id":"park_lake-clark","title":"Lake Clark","nps_link":"https://www.nps.gov/lacl/index.htm"},"highlight":{"description":["Temperate rainforests, <em>a</em> tundra plateau, and three mountain ranges complete the landscape."]}},{"_index":"national-parks","_type":"_doc","_id":"U218l2oBD5fKNxKi45d-","_score":0.5249908,"_source":{"description":"Wind Cave is distinctive for its calcite fin formations called boxwork, a unique formation rarely found elsewhere, and needle-like growths called frostwork. The cave is one of the longest and most complex caves in the world. Above ground is a mixed-grass prairie with animals such as bison, black-footed ferrets, and prairie dogs, and ponderosa pine forests that are home to cougars and elk. The cave is culturally significant to the Lakota people as the site 'from which Wakan Tanka, the Great Mystery, sent the buffalo out into their hunting grounds.'","id":"park_wind-cave","title":"Wind Cave","nps_link":"https://www.nps.gov/wica/index.htm"},"highlight":{"description":["Wind Cave is distinctive for its calcite fin formations called boxwork, <em>a</em> unique formation rarely found elsewhere, and needle-like growths called frostwork."]}},{"_index":"national-parks","_type":"_doc","_id":"NG18l2oBD5fKNxKi45d9","_score":0.5147043,"_source":{"description":"Grand Teton is the tallest mountain in the Teton Range. The park's historic Jackson Hole and reflective piedmont lakes teem with endemic wildlife, with a backdrop of craggy mountains that rise abruptly from the sage-covered valley.","id":"park_grand-teton","title":"Grand Teton","nps_link":"https://www.nps.gov/grte/index.htm"},"highlight":{"description":["The park's historic Jackson Hole and reflective piedmont lakes teem with endemic wildlife, with <em>a</em> backdrop of craggy mountains that rise abruptly from the sage-covered valley."]}},{"_index":"national-parks","_type":"_doc","_id":"IG18l2oBD5fKNxKi45d9","_score":0.5019053,"_source":{"description":"The Badlands are a collection of buttes, pinnacles, spires, and mixed-grass prairies. The White River Badlands contain the largest assemblage of known late Eocene and Oligocene mammal fossils. The wildlife includes bison, bighorn sheep, black-footed ferrets, and prairie dogs.","id":"park_badlands","title":"Badlands","nps_link":"https://www.nps.gov/badl/index.htm"},"highlight":{"description":["The Badlands are <em>a</em> collection of buttes, pinnacles, spires, and mixed-grass prairies. The White River Badlands contain the largest assemblage of known late Eocene and Oligocene mammal fossils."]}},{"_index":"national-parks","_type":"_doc","_id":"UG18l2oBD5fKNxKi45d-","_score":0.4937206,"_source":{"description":"This region that enticed and influenced President Theodore Roosevelt consists of a park of three units in the northern badlands. Besides Roosevelt's historic cabin, there are numerous scenic drives and backcountry hiking opportunities. Wildlife includes American bison, pronghorn, bighorn sheep, and wild horses.","id":"park_theodore-roosevelt","title":"Theodore Roosevelt","nps_link":"https://www.nps.gov/thro/index.htm"},"highlight":{"description":["This region that enticed and influenced President Theodore Roosevelt consists of <em>a</em> park of three units in the northern badlands."]}},{"_index":"national-parks","_type":"_doc","_id":"SW18l2oBD5fKNxKi45d-","_score":0.4857985,"_source":{"description":"This portion of the Chinle Formation has a large concentration of 225-million-year-old petrified wood. The surrounding Painted Desert features eroded cliffs of red-hued volcanic rock called bentonite. Dinosaur fossils and over 350 Native American sites are also protected in this park.","id":"park_petrified-forest","title":"Petrified Forest","nps_link":"https://www.nps.gov/pefo/index.htm"},"highlight":{"description":["This portion of the Chinle Formation has <em>a</em> large concentration of 225-million-year-old petrified wood."]}},{"_index":"national-parks","_type":"_doc","_id":"LW18l2oBD5fKNxKi45d9","_score":0.47812665,"_source":{"description":"Centered on Denali, the tallest mountain in North America, Denali is serviced by a single road leading to Wonder Lake. Denali and other peaks of the Alaska Range are covered with long glaciers and boreal forest. Wildlife includes grizzly bears, Dall sheep, caribou, and gray wolves.","id":"park_denali","title":"Denali","nps_link":"https://www.nps.gov/dena/index.htm"},"highlight":{"description":["Centered on Denali, the tallest mountain in North America, Denali is serviced by <em>a</em> single road leading to Wonder Lake."]}},{"_index":"national-parks","_type":"_doc","_id":"JW18l2oBD5fKNxKi45d9","_score":0.47069332,"_source":{"description":"This landscape was eroded into a maze of canyons, buttes, and mesas by the combined efforts of the Colorado River, Green River, and their tributaries, which divide the park into three districts. The park also contains rock pinnacles and arches, as well as artifacts from Ancient Pueblo peoples.","id":"park_canyonlands","title":"Canyonlands","nps_link":"https://www.nps.gov/cany/index.htm"},"highlight":{"description":["This landscape was eroded into <em>a</em> maze of canyons, buttes, and mesas by the combined efforts of the Colorado River, Green River, and their tributaries, which divide the park into three districts."]}},{"_index":"national-parks","_type":"_doc","_id":"K218l2oBD5fKNxKi45d9","_score":0.4634876,"_source":{"description":"This park along the Cuyahoga River has waterfalls, hills, trails, and exhibits on early rural living. The Ohio and Erie Canal Towpath Trail follows the Ohio and Erie Canal, where mules towed canal boats. The park has numerous historic homes, bridges, and structures, and also offers a scenic train ride.","id":"park_cuyahoga-valley","title":"Cuyahoga Valley","nps_link":"https://www.nps.gov/cuva/index.htm"},"highlight":{"description":["The park has numerous historic homes, bridges, and structures, and also offers <em>a</em> scenic train ride."]}}]},"aggregations":{"visitors":{"buckets":[{"key":"0 - 10000","from":0.0,"to":10000.0,"doc_count":0},{"key":"10001 - 100000","from":10001.0,"to":100000.0,"doc_count":5},{"key":"100001 - 500000","from":100001.0,"to":500000.0,"doc_count":8},{"key":"500001 - 1000000","from":500001.0,"to":1000000.0,"doc_count":9},{"key":"1000001 - 5000000","from":1000001.0,"to":5000000.0,"doc_count":13},{"key":"5000001 - 10000000","from":5000001.0,"to":1.0E7,"doc_count":2},{"key":"10000001+","from":1.0000001E7,"doc_count":1}]},"world_heritage_site":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":0,"key_as_string":"false","doc_count":30},{"key":1,"key_as_string":"true","doc_count":8}]},"acres":{"buckets":[{"key":"Any","from":-1.0,"doc_count":38},{"key":"Small","from":0.0,"to":1000.0,"doc_count":0},{"key":"Medium","from":1001.0,"to":100000.0,"doc_count":13},{"key":"Large","from":100001.0,"doc_count":25}]},"states":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"Alaska","doc_count":5},{"key":"California","doc_count":5},{"key":"Utah","doc_count":5},{"key":"Arizona","doc_count":3},{"key":"Colorado","doc_count":3},{"key":"South Dakota","doc_count":2},{"key":"Texas","doc_count":2},{"key":"Arkansas","doc_count":1},{"key":"Florida","doc_count":1},{"key":"Hawaii","doc_count":1},{"key":"Michigan","doc_count":1},{"key":"Minnesota","doc_count":1},{"key":"Montana","doc_count":1},{"key":"Nevada","doc_count":1},{"key":"North Carolina","doc_count":1},{"key":"North Dakota","doc_count":1},{"key":"Ohio","doc_count":1},{"key":"Tennessee","doc_count":1},{"key":"Virginia","doc_count":1},{"key":"Washington","doc_count":1},{"key":"Wyoming","doc_count":1}]}}})
    };
});
